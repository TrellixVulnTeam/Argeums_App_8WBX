{"version":3,"file":"select2.component.js","sourceRoot":"","sources":["../../.tmp/select2/select2.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, ViewChild, ElementRef, forwardRef, Input, Output, EventEmitter, SimpleChanges, Renderer } from '@angular/core';\r\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\r\n\r\ndeclare let $: any;\r\n\r\n@Component({\r\n  selector: 'l-select2',\r\n  template: `\r\n    <select #selectControll [disabled]=\"disabled\" style=\"width: 100%\">\r\n      <ng-content select=\"option, optgroup\">\r\n      </ng-content>\r\n    </select>\r\n  `,\r\n  providers: [{\r\n    provide: NG_VALUE_ACCESSOR,\r\n    useExisting: forwardRef(() => LSelect2Component),\r\n    multi: true\r\n  }]\r\n})\r\n\r\nexport class LSelect2Component implements ControlValueAccessor {\r\n\r\n  @ViewChild('selectControll')\r\n  selectControll: ElementRef;\r\n\r\n  @Input()\r\n  data: Array<any>;\r\n\r\n  @Input()\r\n  disabled: boolean;\r\n\r\n  @Input()\r\n  options: any = {};\r\n\r\n  @Output()\r\n  valueChange: EventEmitter<any> = new EventEmitter<any>();\r\n\r\n  selectedValue: any | Array<any>\r\n  _jqueryElement: any;\r\n\r\n  _onChange = (_: any) => { };\r\n  _onTouched = () => { };\r\n\r\n  constructor(\r\n    private _renderer: Renderer) {\r\n\r\n  }\r\n\r\n  ngOnInit() { }\r\n\r\n  ngAfterViewInit() {\r\n    this._jqueryElement = $(this.selectControll.nativeElement);\r\n    this.initSelect2();\r\n\r\n    this._jqueryElement.on('select2:select select2:unselect', (e: any) => {\r\n      let data = this._jqueryElement.select2('data');\r\n      for (let item of data) {\r\n        delete item.element;\r\n        delete item.disabled;\r\n        delete item.selected;\r\n      }\r\n      if (!this.options.multiple) {\r\n        data = (e.type == 'select2:unselect') ? null : data[0];\r\n      }\r\n      this._onChange(data);\r\n      this.valueChange.emit(data);\r\n    });\r\n    if (this.selectedValue) {\r\n      this.setSelect2Value(this.selectedValue);\r\n    }\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges) {\r\n    if (!this._jqueryElement) return;\r\n    if (changes['data'] && JSON.stringify(changes['data'].previousValue) !== JSON.stringify(changes['data'].currentValue)) {\r\n      this.initSelect2();\r\n      if (this.selectedValue) {\r\n        this.setSelect2Value(this.selectedValue);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this._jqueryElement.select2('destroy');\r\n  }\r\n\r\n  writeValue(value: any | Array<any>): void {\r\n    this.selectedValue = value;\r\n    if (value !== null && value !== undefined)\r\n      this.setSelect2Value(value);\r\n  }\r\n\r\n  registerOnChange(fn: (_: any) => {}): void {\r\n    this._onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: () => {}): void {\r\n    this._onTouched = fn;\r\n  }\r\n\r\n  initSelect2() {\r\n    if (this._jqueryElement.hasClass('select2-hidden-accessible') == true) {\r\n      this._jqueryElement.select2('destroy');\r\n      this._renderer.setElementProperty(this.selectControll.nativeElement, 'innerHTML', '');\r\n    }\r\n\r\n    let options: any = {\r\n      data: this.data\r\n    };\r\n    Object.assign(options, this.options);\r\n    this._jqueryElement.select2(options);\r\n  }\r\n\r\n  setSelect2Value(value: any | Array<any>) {\r\n    if (!this._jqueryElement || !value) {\r\n      this.selectedValue = value;\r\n      return;\r\n    };\r\n    let targetVal = value['id'] || value;\r\n    if (Array.isArray(value)) {\r\n      targetVal = value.map(x => x['id']);\r\n    }\r\n    this._jqueryElement.val(targetVal).trigger('change');\r\n  }\r\n}\r\n"]}